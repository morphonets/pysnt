{% extends "pydata_sphinx_theme/layout.html" %}

{% block extrahead %}
{{ super() }}
<style>
/* Navbar layout adjustments */
.bd-header__inner {
    display: flex !important;
    align-items: center !important;
    width: 100% !important;
    max-width: 1200px !important;
    margin: 0 auto !important;
    padding: 0 1rem !important;
    gap: 1rem !important;
}

.navbar-header-items {
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    width: 100% !important;
    gap: 1rem !important;
}

.navbar-header-items__start {
    flex-shrink: 0 !important;
}

.navbar-header-items__end {
    display: flex !important;
    align-items: center !important;
    gap: 0.5rem !important;
    flex-shrink: 0 !important;
}

/* Custom navbar center */
.pysnt-navbar-center {
    display: flex !important;
    align-items: center !important;
    gap: 1.5rem !important;
    flex: 1 !important;
    justify-content: center !important;
    margin: 0 1rem !important;
}

/* Navigation links styling */
.pysnt-navbar-center .nav-link {
    color: #2c3e50 !important;
    text-decoration: none !important;
    font-weight: 500 !important;
    padding: 0.5rem 0.75rem !important;
    border-radius: 0.25rem !important;
    transition: all 0.2s !important;
    display: flex !important;
    align-items: center !important;
    gap: 0.4rem !important;
    white-space: nowrap !important;
    font-size: 0.9rem !important;
    height: 40px !important;
}

.pysnt-navbar-center .nav-link:hover {
    color: #2980b9 !important;
    background-color: rgba(41, 128, 185, 0.1) !important;
    text-decoration: none !important;
}

/* Right side elements */
.navbar-header-items__end .navbar-item {
    display: flex !important;
    align-items: right !important;
}

.navbar-header-items__end .pysnt-nav-link,
.navbar-header-items__end .pysnt-theme-toggle {
    color: #2c3e50 !important;
    padding: 0.5rem !important;
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 1.1rem !important;
    transition: all 0.2s !important;
    text-decoration: none !important;
    background: none !important;
    border: none !important;
    cursor: pointer !important;
}

.navbar-header-items__end .pysnt-nav-link:hover,
.navbar-header-items__end .pysnt-theme-toggle:hover {
    color: #2980b9 !important;
    background-color: rgba(41, 128, 185, 0.1) !important;
}

/* Ensure all navbar elements are properly aligned */
.bd-header__inner > * {
    align-self: center !important;
}

/* Fix search button alignment */
.navbar-header-items__end .navbar-persistent--container {
    display: flex !important;
    align-items: center !important;
    height: 40px !important;
}

/* Dark theme adjustments */
[data-theme="dark"] .bd-navbar {
    background-color: #2d2d2d !important;
    border-bottom: 1px solid #404040;
}

[data-theme="dark"] .pysnt-navbar-center .nav-link {
    color: #e0e0e0 !important;
}

[data-theme="dark"] .pysnt-navbar-center .nav-link:hover {
    color: #64b5f6 !important;
    background-color: rgba(100, 181, 246, 0.1) !important;
}

[data-theme="dark"] .navbar-header-items__end .pysnt-nav-link,
[data-theme="dark"] .navbar-header-items__end .pysnt-theme-toggle {
    color: #e0e0e0 !important;
}

[data-theme="dark"] .navbar-header-items__end .pysnt-nav-link:hover,
[data-theme="dark"] .navbar-header-items__end .pysnt-theme-toggle:hover {
    color: #64b5f6 !important;
    background-color: rgba(100, 181, 246, 0.1) !important;
}
</style>

<script>
// Embedded JavaScript for proper navbar integration
document.addEventListener('DOMContentLoaded', function() {
    console.log('Integrating pySNT navigation into existing navbar...');
    
    // Wait a bit for the navbar to be fully rendered
    setTimeout(function() {
        const navbar = document.querySelector('.bd-header__inner');
        if (!navbar) {
            console.log('Navbar not found, retrying...');
            return;
        }
        
        // Find the main navbar items container
        const navbarItems = navbar.querySelector('.navbar-header-items');
        const endContainer = navbar.querySelector('.navbar-header-items__end');
        
        if (!navbarItems || !endContainer) {
            console.log('Navbar containers not found');
            return;
        }
        
        // Create center navigation
        const centerNav = document.createElement('div');
        centerNav.className = 'pysnt-navbar-center';
        centerNav.innerHTML = `
            <a class="nav-link" href="install.html">
                <i class="fas fa-download"></i> Install
            </a>
            <a class="nav-link" href="notebooks/index.html">
                <i class="fas fa-book"></i> Notebooks
            </a>
            <a class="nav-link" href="https://imagej.net/plugins/snt/" target="_blank">
                <i class="fas fa-question-circle"></i> Ask a Question
            </a>
            <a class="nav-link" href="https://imagej.net/plugins/snt/contribute" target="_blank">
                <i class="fas fa-hands-helping"></i> Contribute
            </a>
            <a class="nav-link" href="https://imagej.net/plugins/snt/" target="_blank">
                <i class="fas fa-book-open"></i> SNT User Manual
            </a>
        `;
        
        // Insert center navigation
        navbarItems.insertBefore(centerNav, endContainer);
        
        // Add GitHub link and theme toggle to end container
        const githubContainer = document.createElement('div');
        githubContainer.className = 'navbar-item';
        githubContainer.innerHTML = `
            <a class="pysnt-nav-link" href="https://github.com/morphonets/pysnt" target="_blank" title="GitHub Repository">
                <i class="fab fa-github"></i>
            </a>
        `;
        
        const themeContainer = document.createElement('div');
        themeContainer.className = 'navbar-item';
        themeContainer.innerHTML = `
            <button class="pysnt-theme-toggle" id="pysnt-theme-toggle" title="Switch between light and dark mode">
                <i class="fas fa-sun" id="pysnt-theme-icon"></i>
            </button>
        `;
        
        // Add GitHub and theme toggle after the search button
        endContainer.appendChild(themeContainer);
        endContainer.appendChild(githubContainer);
        
        // Setup theme toggle
        setupThemeToggle();
        
        console.log('pySNT navigation integrated successfully!');
        
    }, 300);
});

function setupThemeToggle() {
    const themeToggle = document.getElementById('pysnt-theme-toggle');
    const themeIcon = document.getElementById('pysnt-theme-icon');
    const body = document.body;
    
    if (!themeToggle || !themeIcon) {
        console.log('Theme toggle elements not found');
        return;
    }
    
    // Check for saved theme preference or default to 'light'
    const currentTheme = localStorage.getItem('theme') || 'light';
    
    // Apply the saved theme
    if (currentTheme === 'dark') {
        body.setAttribute('data-theme', 'dark');
        themeIcon.className = 'fas fa-moon';
    } else {
        body.setAttribute('data-theme', 'light');
        themeIcon.className = 'fas fa-sun';
    }
    
    // Theme switch event listener
    themeToggle.addEventListener('click', function() {
        const currentTheme = body.getAttribute('data-theme');
        
        if (currentTheme === 'dark') {
            body.setAttribute('data-theme', 'light');
            themeIcon.className = 'fas fa-sun';
            localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            themeIcon.className = 'fas fa-moon';
            localStorage.setItem('theme', 'dark');
        }
    });
    
    console.log('Theme toggle setup complete');
}
</script>
{% endblock %}