{% extends "pydata_sphinx_theme/layout.html" %}

{% block extrahead %}
{{ super() }}
<style>
    /* Navbar layout adjustments */
    .bd-header__inner {
        display: flex !important;
        align-items: center !important;
        width: 100% !important;
        max-width: 1200px !important;
        margin: 0 auto !important;
        padding: 0 1rem !important;
        gap: 1rem !important;
        position: relative !important;
    }

    .navbar-header-items {
        display: flex !important;
        align-items: center !important;
        flex: 1 !important;
        width: 100% !important;
        gap: 1rem !important;
    }

    .navbar-header-items__start {
        flex-shrink: 0 !important;
    }

    .navbar-header-items__end {
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        flex-shrink: 0 !important;
    }

    /* Theme toggle button styling */
    .pysnt-theme-toggle {
        color: var(--pst-color-text-base) !important;
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        padding: 0.5rem !important;
        border-radius: 0.25rem !important;
        transition: all 0.2s !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .pysnt-theme-toggle:hover {
        background-color: var(--pst-color-surface) !important;
    }

    /* Add spacing between FontAwesome icons and text in navigation */
    .navbar-nav .nav-link i[class*="fa-"]:not(:last-child),
    .navbar-nav .nav-link i[class*="fas"]:not(:last-child),
    .navbar-nav .nav-link i[class*="fab"]:not(:last-child),
    .navbar-nav .nav-link i[class*="far"]:not(:last-child) {
        margin-right: 0.4rem !important;
    }

    /* Also apply to dropdown items */
    .dropdown-item i[class*="fa-"]:not(:last-child),
    .dropdown-item i[class*="fas"]:not(:last-child),
    .dropdown-item i[class*="fab"]:not(:last-child),
    .dropdown-item i[class*="far"]:not(:last-child) {
        margin-right: 0.4rem !important;
    }

    /* Hide main navigation items on mobile when hamburger menu is active */
    @media (max-width: 959px) {
        .navbar-nav:not(.navbar-nav-scroll) {
            display: none !important;
        }
        
        /* Keep only the icon links visible on mobile */
        .navbar-icon-links {
            display: flex !important;
        }
        
        /* Ensure hamburger menu button is visible */
        .navbar-toggler {
            display: block !important;
        }
    }

    /* Dark theme adjustments */
    [data-theme="dark"],
    [data-theme="dark"] body,
    [data-theme="dark"] .bd-main,
    [data-theme="dark"] .bd-content,
    [data-theme="dark"] .bd-article-container {
        background-color: #1a1a1a !important;
        color: #e0e0e0 !important;
    }

    [data-theme="dark"] .bd-navbar,
    [data-theme="dark"] .bd-header {
        background-color: #2d2d2d !important;
        border-bottom: 1px solid #404040 !important;
    }

    [data-theme="dark"] .pysnt-theme-toggle {
        color: #e0e0e0 !important;
    }

    [data-theme="dark"] .pysnt-theme-toggle:hover {
        color: #64b5f6 !important;
        background-color: rgba(100, 181, 246, 0.1) !important;
    }

    /* Logo styling with home icon */
    .bd-navbar .navbar-brand {
        position: relative !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .bd-navbar .navbar-brand img {
        height: 40px;
        width: auto;
    }
    
    /* Add home icon to logo */
    .bd-navbar .navbar-brand::before {
        content: "\f015";
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        font-size: 1.2rem;
        color: #2c3e50;
        margin-right: 0.3rem;
    }
    
    /* Dark theme support for logo home icon */
    [data-theme="dark"] .bd-navbar .navbar-brand::before {
        color: #e0e0e0;
    }



    /* Dark theme for hero section */
    [data-theme="dark"] .hero-title {
        color: #e0e0e0 !important;
    }

    [data-theme="dark"] .hero-subtitle {
        color: #b0b0b0 !important;
    }

    [data-theme="dark"] .hero-description {
        color: #a0a0a0 !important;
    }

    [data-theme="dark"] .gallery-card {
        background: #2d2d2d !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
    }

    [data-theme="dark"] .btn-primary-custom {
        background-color: #64b5f6 !important;
        color: #1a1a1a !important;
    }

    [data-theme="dark"] .btn-secondary-custom {
        color: #64b5f6 !important;
        border-color: #64b5f6 !important;
    }

    [data-theme="dark"] .btn-secondary-custom:hover {
        background-color: #64b5f6 !important;
        color: #1a1a1a !important;
    }
</style>

<script>
    // Simple theme toggle setup
    document.addEventListener('DOMContentLoaded', function () {
        // Wait for theme to fully load
        setTimeout(function() {
            addThemeToggleToNavbar();
            setupThemeToggle();
        }, 100);
    });

    function addThemeToggleToNavbar() {
        // Find the navbar icon links container
        const iconLinks = document.querySelector('.navbar-icon-links');
        if (!iconLinks) return;

        // Add theme toggle button to the icon links
        const themeToggle = document.createElement('button');
        themeToggle.className = 'pysnt-theme-toggle navbar-icon-links__item';
        themeToggle.id = 'pysnt-theme-toggle';
        themeToggle.title = 'Switch between light and dark mode';
        themeToggle.innerHTML = '<i class="fas fa-sun" id="pysnt-theme-icon"></i>';
        
        // Insert before the first icon link (GitHub)
        iconLinks.insertBefore(themeToggle, iconLinks.firstChild);
    }

    function setupThemeToggle() {
        const themeToggle = document.getElementById('pysnt-theme-toggle');
        const themeIcon = document.getElementById('pysnt-theme-icon');
        const body = document.body;

        if (!themeToggle || !themeIcon) {
            console.log('Theme toggle elements not found, retrying...');
            // Retry after a short delay if elements aren't found
            setTimeout(setupThemeToggle, 200);
            return;
        }

        // Check for saved theme preference or default to 'light'
        const currentTheme = localStorage.getItem('theme') || 'light';

        // Apply the saved theme
        if (currentTheme === 'dark') {
            body.setAttribute('data-theme', 'dark');
            document.documentElement.setAttribute('data-theme', 'dark');
            themeIcon.className = 'fas fa-moon';
        } else {
            body.setAttribute('data-theme', 'light');
            document.documentElement.setAttribute('data-theme', 'light');
            themeIcon.className = 'fas fa-sun';
        }

        // Theme switch event listener
        themeToggle.addEventListener('click', function () {
            const currentTheme = body.getAttribute('data-theme');
            console.log('Theme toggle clicked! Current theme:', currentTheme);

            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'light');
                document.documentElement.setAttribute('data-theme', 'light');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
                console.log('Switched to light theme');
            } else {
                body.setAttribute('data-theme', 'dark');
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
                console.log('Switched to dark theme');
            }
        });

        console.log('Theme toggle setup complete');
    }

    // Add API Overview link to auto-generated API pages
    function addApiOverviewLink() {
        // Check if we're on an auto-generated API page
        const currentPath = window.location.pathname;
        if (!currentPath.includes('/api_auto/')) {
            return;
        }

        // Find the sidebar navigation
        const sidebarNav = document.querySelector('.bd-docs-nav .bd-toc-item');
        if (!sidebarNav) {
            console.log('Sidebar navigation not found');
            return;
        }

        // Create the API Overview link
        const apiOverviewItem = document.createElement('div');
        apiOverviewItem.className = 'api-overview-link';
        apiOverviewItem.style.cssText = `
            margin-bottom: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        `;

        // Determine the correct path to api.html based on current location
        const pathSegments = currentPath.split('/');
        const apiPath = '../api.html'; // Go up one level from api_auto/

        apiOverviewItem.innerHTML = `
            <a href="${apiPath}" class="api-overview-btn" style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.4rem 0.8rem;
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                color: #495057;
                text-decoration: none;
                font-size: 0.875rem;
                font-weight: 500;
                transition: all 0.2s;
                width: 100%;
                justify-content: center;
            ">
                <i class="fas fa-home"></i>
                API Overview
            </a>
        `;

        // Add hover effects
        const link = apiOverviewItem.querySelector('.api-overview-btn');
        link.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#e9ecef';
            this.style.borderColor = '#adb5bd';
            this.style.color = '#212529';
        });
        
        link.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#f8f9fa';
            this.style.borderColor = '#dee2e6';
            this.style.color = '#495057';
        });

        // Insert at the beginning of the sidebar navigation
        sidebarNav.insertBefore(apiOverviewItem, sidebarNav.firstChild);

        console.log('API Overview link added to sidebar');
    }

    // Add dark theme support for API Overview link
    function updateApiOverviewLinkTheme() {
        const apiLink = document.querySelector('.api-overview-btn');
        if (!apiLink) return;

        const isDark = document.body.getAttribute('data-theme') === 'dark';
        
        if (isDark) {
            apiLink.style.backgroundColor = '#2d2d2d';
            apiLink.style.borderColor = '#404040';
            apiLink.style.color = '#e0e0e0';
            
            apiLink.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#404040';
                this.style.borderColor = '#64b5f6';
                this.style.color = '#64b5f6';
            });
            
            apiLink.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '#2d2d2d';
                this.style.borderColor = '#404040';
                this.style.color = '#e0e0e0';
            });
        } else {
            apiLink.style.backgroundColor = '#f8f9fa';
            apiLink.style.borderColor = '#dee2e6';
            apiLink.style.color = '#495057';
        }
    }

    // Initialize API navigation enhancement
    document.addEventListener('DOMContentLoaded', function() {
        addApiOverviewLink();
        updateApiOverviewLinkTheme();
        
        // Update theme when theme toggle is clicked
        const themeToggle = document.getElementById('pysnt-theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                setTimeout(updateApiOverviewLinkTheme, 100);
            });
        }
    });
</script>
{% endblock %}